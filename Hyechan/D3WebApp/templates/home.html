<html>
<meta charset="utf-8"> 
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/mystyle.css') }}">
    <script src = "{{url_for('static', filename='js/d3.js') }}"></script>
    <script>
        function showTooltip(myID) {
            d3.select("#" + myID)
                .selectAll("div")
                    .style("visibility", "visible");
        }

        function hideTooltip(myID) {
            d3.select("#" + myID)
                .selectAll("div")
                    .style("visibility", "hidden");
        }
    </script>
</head>
    <body>
        <div class="center">
            <h2 style = "text-align:center">Input text to find out how easily a computer could predict it</h2>
            <form action="/result" style = "text-align:center", method="POST">
                Text: <input type='text' name='text'><br><br>
                Predictions per word: <input type='text' name='number'><br><br>
                <input type='submit' value='Continue'>
            </form>
        </div><br>

        <div class="results">
            <strong>Your input:</strong>  <br>
            
            {%for item in inputs%}
                {%set currentWord, color = item%}
                {%set index = inputs.index(item)%}
                <script>
                    d3.select(".results")
                        .append("mark")
                            .attr("id", "tooltip{{index}}")
                            .attr("class", "tooltip")
                            .style("background-color", "{{color}}")
                            .style("font-size", "150%")
                            .text("{{currentWord}}")
                            .on("mouseover", function(){showTooltip(this.id);})
                            .on("mouseout", function(){hideTooltip(this.id);});
                </script>
                {%if index != 0%}
                    <script>
                        d3.select("#tooltip{{index}}")
                            .append("div")
                                .attr("id", "tooltiptext{{index}}")
                                .attr("class", "tooltiptext")
                                .append("ol")
                                    .attr("id", "list{{index}}");
                    </script>
                    {%for i in predictions[index - 1]%}
                        {%if positions[index - 1] == predictions[index - 1].index(i)%}
                            <script>
                                d3.select("#list{{index}}")
                                    .append("li")
                                        .append("mark")
                                            .text("{{i}}");
                            </script>
                        {%else%}
                            <script>
                                d3.select("#list{{index}}")
                                    .append("li")
                                        .text("{{i}}");
                            </script>
                        {%endif%}
                    {%endfor%}
                {%endif%}
            {%endfor%}
            <br><br>
            <span style="background-color:lime;">Expected</span> (appeared in the first 10 predictions)<br>
            <span style="background-color:yellow;">Somewhat predictable</span> (appeared in the first 100 predictions)<br>
            <span style="background-color:red;">Somewhat unpredictable</span> (appeared in the first 1000 predictions)<br>
            <span style="background-color:magenta;">Unexpected</span> (didn't appear in the first 1000 predictions)<br><br>

            <strong>The predictability score for the top {{ depth }} results is: </strong>{{ final_score }}<br><br>

        </div>
    </body>
</html>